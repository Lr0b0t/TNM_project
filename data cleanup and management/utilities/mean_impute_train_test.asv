clc; close all; clear;

%--------------------------------------------------------------------------
% Purpose:
%   Impute missing data in train and test sets separately using the column mean,
%   and save the results as new CSV files with '_imputed' in the name.
%

% Inputs:
%   - train_features_Q2.csv: Training set (contains NaNs)
%   - test_features_Q2.csv:  Test set (contains NaNs)
%
% Outputs:
%   - train_features_Q2_imputed.csv: Training set with missing values replaced
%   - test_features_Q2_imputed.csv:  Test set with missing values replaced
%
% Notes:
%   - Imputation is performed **separately** on train and test sets
%     (means computed only within each set), so no leakage occurs.
%--------------------------------------------------------------------------

% Define paths
baseDir = fullfile('..', 'final files');
trainFile = fullfile(baseDir, 'train_features_Q2.csv');
testFile  = fullfile(baseDir, 'test_features_Q2.csv');

trainOutFile = fullfile(baseDir, 'train_features_Q2_imputed.csv');
testOutFile  = fullfile(baseDir, 'test_features_Q2_imputed.csv');

% Read train and test sets
train_tbl = readtable(trainFile);
test_tbl  = readtable(testFile);

% Identify numeric columns (to impute)
isNumTrain = varfun(@isnumeric, train_tbl, 'OutputFormat', 'uniform');
isNumTest  = varfun(@isnumeric, test_tbl,  'OutputFormat', 'uniform');

numVarsTrain = train_tbl.Properties.VariableNames(isNumTrain);
numVarsTest  = test_tbl.Properties.VariableNames(isNumTest);

% Impute missing values in train set (with train set means)
for i = 1:numel(numVarsTrain)
    col = numVarsTrain{i};
    x = train_tbl.(col);
    if any(isnan(x))
        m = mean(x(~isnan(x)));
        x(isnan(x)) = m;
        train_tbl.(col) = x;
    end
end

% Impute missing values in test set (with test set means)
for i = 1:numel(numVarsTest)
    col = numVarsTest{i};
    x = test_tbl.(col);
    if any(isnan(x))
        m = mean(x(~isnan(x)));
        x(isnan(x)) = m;
        test_tbl.(col) = x;
    end
end

% Save imputed tables to new files
writetable(train_tbl, trainOutFile);
writetable(test_tbl, testOutFile);

fprintf('Imputed train set saved to %s (%d rows)\n', trainOutFile, height(train_tbl));
fprintf('Imputed test set saved to %s (%d rows)\n', testOutFile, height(test_tbl));
